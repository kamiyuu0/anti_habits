<div class="container mx-auto px-4 py-6">
  <!-- メイン投稿 -->
  <div class="card bg-base-100 shadow-xl rounded-2xl border border-base-300 mb-8">
    <div class="card-body p-8">
      <!-- ユーザー情報 -->
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center">
            <i class="fas fa-user text-lg mr-3"></i>
            <div>
              <h3 class="font-semibold text-lg"><%= @anti_habit.user.name %></h3>
            </div>
        </div>
        
        <!-- 本人マーク -->
        <% if current_user == @anti_habit.user %>
          <div class="badge badge-info text-[8px] sm:text-sm">
            あなたの投稿
          </div>
        <% end %>
      </div>

      <!-- タイトル -->
      <div class="mb-6">
        <h1 class="text-3xl font-bold mb-2">
          <%= @anti_habit.title %>
        </h1>
        <div class="badge badge-success badge-lg">
          連続<%= @anti_habit.consecutive_days_achieved %>日達成！
        </div>
      </div>

      <!-- 説明 -->
      <div class="mb-6">
        <div class="prose max-w-none">
          <p class="text-base-content/80 leading-relaxed whitespace-pre-wrap"><%= @anti_habit.description %></p>
        </div>
      </div>

      <!-- タグ -->
      <% if @anti_habit.tags.any? %>
        <div class="mb-6">
          <div class="flex flex-wrap gap-2">
            <% @anti_habit.tags.each do |tag| %>
              <div class="badge badge-outline badge-primary">
                <%= link_to anti_habits_path(tag: tag.name) do %>
                  #<%= tag.name %>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- 記録トグル（本人のみ） -->
      <% if current_user&.own?(@anti_habit) %>
        <div class="mb-6">
          <div class="text-center mb-4">
            <span class="text-lg font-medium">今日の記録：</span>
          </div>
          
          <div class="flex flex-col space-y-4">
            <% if @today_record %>
              <!-- 記録済みの状態 -->
              <div class="alert alert-success flex flex-col items-center justify-center text-center">
                <div class="flex items-center space-x-2">
                  <span class="text-2xl">💪</span>
                  <span class="font-bold text-lg">我慢できた</span>
                </div>
                <%= button_to "記録を削除", anti_habit_record_path(@today_record), 
                      method: :delete, 
                      data: { turbo_confirm: "記録を削除しますか？" },
                      class: "btn btn-neutral btn-sm mt-3" %>
              </div>
            <% else %>
              <!-- 我慢できたボタン -->
              <div class="card bg-success/10 border border-success/20 hover:bg-success/20 transition-colors cursor-pointer">
                <%= button_to anti_habit_records_path, 
                      params: { anti_habit_id: @anti_habit.id },
                      class: "w-full bg-transparent border-none p-0" do %>
                  <div class="card-body flex items-center justify-center p-6">
                    <div class="flex items-center space-x-2">
                      <span class="text-2xl">💪</span>
                      <span class="font-bold text-lg text-success">我慢できた</span>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>

        <!-- 編集・削除ボタン -->
        <div class="card-actions justify-end">
          <%= link_to "Xでシェアする",
                      "https://twitter.com/intent/tweet?url=#{root_url}anti_habits/#{@anti_habit.id}&text=#{CGI.escape("Anti Habitsで悪習慣を登録！")}%0A#{CGI.escape("悪習慣を辞められるか監視してください！")}\n&hashtags=#{CGI.escape("AntiHabits")}",
                      target: "_blank",
                      rel: "noopener noreferrer",
                      class: "btn btn-outline btn-neutral" %>
          <%= link_to "編集", edit_anti_habit_path(@anti_habit), class: "btn btn-outline btn-primary" %>
          <%= link_to "削除", anti_habit_path(@anti_habit), 
                data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" }, 
                class: "btn btn-outline btn-error" %>
        </div>
      <% end %>

      <!-- リアクションボタン -->
      <% if user_signed_in? %>
        <div class="flex items-center mt-4 space-x-4">
          <%= render "shared/reaction_button", anti_habit: @anti_habit %>
          <div class="flex items-center space-x-1">
            <i class="fas fa-comment"></i>
            <%= @anti_habit.comments.size %>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <!-- コメントセクション（ログイン時のみ表示） -->
  <% if user_signed_in? %>
    <div class="card bg-base-100 shadow-xl rounded-2xl border border-base-300">
      <div class="card-body p-8">
        <h2 class="card-title text-2xl mb-6">
          応援メッセージ
          <div class="badge badge-neutral">
            <%= @comments.count %>件
          </div>
        </h2>

        <!-- 新規コメントフォーム -->
        <div class="mb-6">
          <%= render "comments/form" %>
        </div>

        <!-- 既存コメント一覧 -->
        <div class="space-y-4">
          <% if @comments.any? %>
            <%= render @comments %>
          <% else %>
            <div class="hero min-h-32">
              <div class="hero-content text-center">
                <div>
                  <p class="text-base-content/60 mb-2">
                    まだ応援メッセージはありません
                  </p>
                  <p class="text-base-content/60 text-sm">
                    最初の応援メッセージを投稿してみませんか？
                  </p>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>